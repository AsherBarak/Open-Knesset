<div class="billbox">
	<!-- Only load dom.min.js if it is not already loaded! use a cross browser method to determind if it should be loaded. -->
	<script type="text/javascript" src="{{MEDIA_URL}}js/$dom.min.js"></script>
	<script type="text/javascript">
		if (typeof OKnesset === 'undefined') {
        	OKnesset = {};
        }

		OKnesset.billBox = OKnesset.billBox || {};

		// Detect Animation support
		(function(){
			OKnesset.animation = false;
		    OKnesset.animationstring = 'animation';
		    OKnesset.keyframeprefix = '';
		    var domPrefixes = 'Webkit Moz O ms Khtml'.split(' ');
		    var animationEnd = 'webkitAnimationEnd animationend oAnimationEnd msAnimationEnd Khtml_I_DONT_KNOW'.split(' ');
		    var pfx  = '';
			var elm = $dom.get('.billbox')[0];

			if( elm.style.animationName ) { OKnesset.animation = true; }

			if( OKnesset.animation === false ) {
			  for( var i = 0; i < domPrefixes.length; i++ ) {
			    if( elm.style[ domPrefixes[i] + 'AnimationName' ] !== undefined ) {
			      pfx = domPrefixes[ i ];
			      OKnesset.animationstring = pfx + 'Animation';
			      OKnesset.animationEndEvent = animationEnd[i];
			      OKnesset.keyframeprefix = '-' + pfx.toLowerCase() + '-';
			      OKnesset.animation = true;
			      break;
			    }
			  }
			}
		})();

		OKnesset.addAnimation = function(elm, animName, animProps, keyFrameContent){
			  elm.style[ OKnesset.animationstring ] = animName + ' ' + animProps;

			  var keyframes = '@' + OKnesset.keyframeprefix + 'keyframes '+ animName +' { '+
			  						keyFrameContent +
			                  '}';

			  if( document.styleSheets && document.styleSheets.length ) {
			      document.styleSheets[0].insertRule( keyframes, 0 );
			  } else {
			    var s = document.createElement( 'style' );
			    s.innerHTML = keyframes;
			    document.getElementsByTagName( 'head' )[ 0 ].appendChild( s );
			  }
		}

		OKnesset.drilldata = [];
		OKnesset.drilldata.push({'stage' : 1});
		OKnesset.drilldata.push({'stage' : 2});
		// ...
		OKnesset.drilldata.push({'stage' : 6});

		{% if bill.pre_votes.count  > 0 %}
			OKnesset.drilldata[1] = {{pre_vote_drill_data|safe}};
		{% endif %}


	</script>
	<div class="header header-small">
		<div class="billbox-details">
			<div class="title">
			  <a href="/bill/3260/" target="_blank">
				<span class="label">שם ההצעה:</span>
                <h1>{{bill.law.title}}: {{bill.title}}</h1>
			  </a>
			</div>
			<div class="excerpt">
				<span class="label">תקציר:</span>
				<div class="explanation"></div>
			</div>
			<div class="external-links">
				<span class="label">קישורים נוספים:</span>
                <a href="{{ bill.get_absolute_url }}" class="oknesset-resource" target='_blank'>החוק באתר כנסת פתוחה</a>
			</div>
			<div>
				<span class="status"></span>
			</div>
		</div>
		<div class="pms">
			<div class="label">יזמו:</div>
			<ul>

                {% for proposer in proposers_first3 %}
                <li><a href="{% url member-detail proposer.id %}"><img src="{{proposer.img_url}}" alt="{{proposer.name}}" title="{{proposer.name}}"/></a></li>
                {% endfor %}

			</ul>
			{% if proposers_count_minus3 > 0 %}
			<a href="#" class="more">+{{proposers_count_minus3}} </a>
			{% endif %}
		</div>
		<div class="pull"><div class="arrow down"></div></div>
	</div>
	<script type="text/javascript">
		function getSenderDiv(e){
			var sender = (e && e.target) || (window.event && window.event.srcElement);
			return sender.tagName.toLowerCase() === 'li'? sender : $dom.ancestor(sender, 'li');
		}
		OKnesset.drill = function(e){
			console.log("function drill ");
			var senderDiv = getSenderDiv(e);
			var graph = $dom.get('.graph')[0];
			// TOOD remove "drilled" from all other steps
			$dom.addClass(graph, 'drilling');
			$dom.addClass(senderDiv, 'drilled');

			var stageIndex=$dom.descendants($dom.ancestor(senderDiv), "li").indexOf(senderDiv);
			var stepsDiv = $dom.get('div.graph ul.steps')[0];
			var margin = 2.5 -(760/8 * stageIndex);

			// update "drill" data
			$dom.get(".against_votes span", graph)[0].innerHTML = OKnesset.drilldata[1].against.count;
			$dom.get(".for_votes span", graph)[0].innerHTML = OKnesset.drilldata[1].for.count;
			$dom.style($dom.get(".pms.opposing", graph)[0], {'width' : (100* OKnesset.drilldata[1].against.count / {{pre_vote.votes.count}}) + "%"});
			$dom.style($dom.get(".pms.supporting", graph)[0], {'width' : (100* OKnesset.drilldata[1].for.count / {{pre_vote.votes.count}}) + "%"});

			if( OKnesset.animation === false ) {
				console.log("no animation");
				$dom.addClass(graph, 'drilling-final');
			} else {
				OKnesset.addAnimation(stepsDiv, 'drill', '500ms', '0% {width : 100%; margin-right : 0%} 100% {width: 760%; margin-right : '+ margin+'%}');

				stepsDiv.addEventListener(
				    OKnesset.animationEndEvent,
				    function(){
						stepsDiv.setAttribute("style", "");
						$dom.addClass(graph, 'drilling-final');
						$dom.style(stepsDiv, {'margin-right': margin + '%'});
				    }, false);
			}

			senderDiv.setAttribute("onclick", "OKnesset.undrill(event);");
		}

		OKnesset.undrill = function(e){
			console.log(" function undrill");
			var senderDiv = getSenderDiv(e);

			var graph = $dom.get('.graph')[0];
			// TOOD remove "drilled" from all other steps
			$dom.removeClass(graph, 'drilling');
			$dom.removeClass(graph, 'drilling-final');
			$dom.removeClass(senderDiv, 'drilled');
			var stepsDiv = $dom.get('div.graph ul.steps')[0];
			$dom.style(stepsDiv, {'margin-right': '0%'});

			senderDiv.setAttribute("onclick", "OKnesset.drill(event);");
		}
	</script>
	<div class="graph drilling-">
		<div class="thedrill passed">
			<ul class="pill-nav">
				<li class="details-btn active"><a href="#">פרטי ההצבעה</a></li>
				<li class="meaning-btn"><a href="#">מה זה אומר?</a></li>
				<li class="action-btn"><a href="#">מעורבות אזרחית</a></li>
			</ul>
			<div class="thedrill-details">
				<div class="for_votes">בעד: <span></span></div>
				<div class="against_votes">נגד: <span></span></div>
				<div class="pms supporting">
					<ul name="קדימה">
						<li><a href="/member/784/"><img src="http://www.knesset.gov.il/mk/images/members/michaeli_avraham-s.jpg" alt="אברהם מיכאלי" title="אברהם מיכאלי"/></a><span class="tooltip"><span>אברהם מיכאלי</span></span></li>
						<li><a href="/member/805/"><img src="http://www.knesset.gov.il/mk/images/members/David_Rotem-s.jpg" alt="דוד רותם" title="דוד רותם"/></a><span class="tooltip"><span>דוד רותם</span></span></li>
						<li><a href="/member/768/"><img src="http://www.knesset.gov.il/mk/images/members/elkin_zeev-s.jpg" alt="זאב אלקין" title="זאב אלקין"/></a><span class="tooltip"><span>זאב אלקין</span></span></li>
						<li><a href="/member/776/"><img src="http://www.knesset.gov.il/mk/images/members/schneller_otniel-s.jpg" alt="עתניאל שנלר" title="עתניאל שנלר"/></a><span class="tooltip"><span>עתניאל שנלר</span></span></li>
					</ul>
					<ul name="האיחוד הלאומי">
						<li><a href="/member/768/"><img src="http://www.knesset.gov.il/mk/images/members/elkin_zeev-s.jpg" alt="זאב אלקין" title="זאב אלקין"/></a><span class="tooltip"><span>זאב אלקין</span></span></li>
						<li><a href="/member/776/"><img src="http://www.knesset.gov.il/mk/images/members/schneller_otniel-s.jpg" alt="עתניאל שנלר" title="עתניאל שנלר"/></a><span class="tooltip"><span>עתניאל שנלר</span></span></li>
					</ul>
				</div>
				<div class="pms opposing" style="width:34%">
					<ul name="מרצ">
						<li><a href="/member/768/"><img src="http://www.knesset.gov.il/mk/images/members/elkin_zeev-s.jpg" alt="זאב אלקין" title="זאב אלקין"/></a><span class="tooltip"><span>זאב אלקין</span></span></li>
						<li><a href="/member/776/"><img src="http://www.knesset.gov.il/mk/images/members/schneller_otniel-s.jpg" alt="עתניאל שנלר" title="עתניאל שנלר"/></a><span class="tooltip"><span>עתניאל שנלר</span></span></li>
					</ul>
				</div>
			</div>
			<div class="thedrill-meaning">
				<p>קריאה טרומית ("דיון מוקדם") היא ההצבעה הראשונה על הצעת חוק פרטית. הצעות חוק ממשלתיות פטורות מהצבעה בקריאה טרומית ועולות ישירות לקריאה ראשונה. תוצאות הקריאה הטרומית מוכתבות כמעט תמיד על ידי עמדת הממשלה (קרי, עמדת הקואליציה). הצעה שלא היה לה רוב בקריאה טרומית מבוטלת, ואסור ליוזם ההצעה להעלותה שוב במשך חצי שנה.</p>
				<p>הצעה שכן היה לה רוב, מועברת לדיון בועדה שעליה ממליץ היוזם, להכנה לקריאה ראשונה. אם מוצעת יותר מועדה אחת בה אמורה הצעת החוק להיות נידונה, תקבע ועדת הכנסת היכן תידון ההצעה. לקביעת הועדה המטפלת יש משמעות רבה לגבי המשך סיכויי קידום הצעת החוק ולגבי האופן שבו תעוצב לבסוף. זהות יו"ר הועדה שמטפלת בהצעת החוק עשויה להיות מכרעת לעצם הבאתה לדיון והצבעה נוספים, שכן באפשרותו לעכב את המשך החקיקה על ידי אי-העלאתה ("לקבור את ההצעה"), או לקדם בועדה הצעה לבטל את החקיקה. מנגד, ועדה 'תומכת' תזרז את הטיפול בחוק ותאפשר לסיים את הליכי החקיקה שלו במהירות.</p>
				<p>ההצבעות על חוקים בקריאה טרומית מתקיימות תמיד בימי רביעי, ועל מנת להעלות הצעה להצבעה יש להשתמש במכסה שמוקנית על בסיס סיעתי, דבר המגביל מאוד את מספר ההצעות שח"כ יכול להעלות בזמן נתון. הצעה שזכתה לתמיכת ממשלה מקבלת פטור ממכסה.</p>
				<p>בשלב זה אין צורך ברוב מיוחס בהצבעה על הצעת החוק, גם אם מדובר בהצעה בעלת עלות תקציבית (ראו בהמשך).</p>
			</div>
			<div class="thedrill-action">

			</div>
		</div>
		<span class="status"></span>
		<div class="gov-position">
			<div class="step">
				<span class="date">
					(טרם פורסמה)
				</span>
			</div>
		</div>
        {% with billurl=bill.get_absolute_url %}
		<ul class="steps">

			<li class="initiated passed odd first" onclick="OKnesset.drill(event);">
				<div class="step">
                    {% if bill.proposals.count > 0 %}
                        <a href="{{ billurl }}#bill-initiation" class="link" target="_blank">קישור</a>
                    {% endif %}
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					<div class="tooltip"><span>יזום ההצעה</span></div>
					<span class="date">?</span>
				</div>
			</li>

			<li class="pre-vote" onclick="OKnesset.drill(event);">
                    {% if bill.pre_votes.count > 0 %}
				 	<script type="text/javascript">
				 		// add 'passed' and 'voted' class to the pre-vote li element
						var li_pre_vote = $dom.get("li.pre-vote")[0];
						$dom.addClass(li_pre_vote, "voted");

						if ({{pre_vote_passed|lower}}) {
							$dom.addClass(li_pre_vote, "passed");
						}
				 	</script>
                    {% endif %}

				<div class="step">
                    {% if bill.pre_votes.count > 0 %}
                        <a href="{{ billurl }}#bill-pre-vote" class="link" target="_blank">קישור</a>
                    {% endif %}
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					{% if bill.pre_votes.count > 0 %}
					<div class="tooltip-score">
						<span class="balance">{{pre_vote.for_votes_count}}/{{pre_vote.against_votes_count}}</span>
						<div class="scale" style="width:120px">
							<span class="against" ></span>
							<span class="for"></span>
							<script type="text/javascript">
						 		// set the style of the 'against' span
								OKnesset.billBox.preVote_score_width = {{pre_vote.against_votes_count}} * 120 / ({{pre_vote.for_votes_count}} + {{pre_vote.against_votes_count}});
								var against = $dom.get("li.pre-vote .against")[0];
								// the background-position attribute value 'bottom' might not work on Firefox, or IE
								$dom.style(against, {'width':OKnesset.billBox.preVote_score_width + "px", 'background-position': (OKnesset.billBox.preVote_score_width - 120) + "px bottom" });
							</script>
						</div>
					</div>
                    {% endif %}
					<div class="tooltip"><span>קריאה טרומית</span></div>
					<span class="date">?</span>
					{% if bill.pre_votes.count > 0 %}
					<script type="text/javascript">
				 		// set the pre-vote date
						var pre_vote_date = $dom.get("li.pre-vote span.date")[0];
						pre_vote_date.innerHTML = "{{pre_vote_time.day}}/{{pre_vote_time.month}}<br>{{pre_vote_time.year}}";
					</script>
                    {% endif %}
				</div>
			</li>

			<li class="committee-1 passed odd" onclick="OKnesset.drill(event);">
				<div class="step">
                    {% if bill.first_committee.meetings.count > 0 %}
                        <a href="{{ billurl }}#bill-first-committee-meetings" class="link" target="_blank">קישור</a>
                    {% endif %}

					<span class="icon">icon</span>
					<div class="tooltip"><span>ישיבות ועדה</span></div>
					<span class="date">?</span>
				</div>
			</li>

			<li class="vote-1 passed" onclick="OKnesset.drill(event);">
				<div class="step">
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					<div class="tooltip-score">
						<span class="balance"></span>
						<div class="scale" style="width:120px">
							<span class="against"></span>
							<span class="for"></span>
						</div>
					</div>
					<div class="tooltip"><span>קריאה ראשונה</span></div>
					<span class="date">?</span>
				</div>
			</li>

			<li class="committee-2 passed odd" onclick="OKnesset.drill(event);">
				<div class="step">
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					<div class="tooltip"><span>ישיבות ועדה</span></div>
					<span class="date">?</span>
				</div>
			</li>

			<li class="vote-2 passed" onclick="OKnesset.drill(event);">
				<div class="step">
  				<a href="/bill/3260/#bill-approval" class="link" target="_blank">קישור</a>
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					<div class="tooltip"><span>קריאה שניה</span></div>
					<span class="date">?</span>
				</div>
			</li>

			<li class="vote-3 passed odd" onclick="OKnesset.drill(event);">
				<div class="step">
          <a href="/bill/3260/#bill-approval" class="link" target="_blank">קישור</a>
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					<div class="tooltip"><span>קריאה שלישית</span></div>
					<span class="date">?</span>
				</div>
			</li>

			<li class="accepted passed last" onclick="OKnesset.drill(event);">
				<div class="step">
					<a href="#" class="link">קישור</a>
					<a href="#" class="info">מידע</a>
					<span class="icon">icon</span>
					<div class="tooltip"><span>ההצעה הופכת לחוק</span></div>
					<span class="date">?</span>
				</div>
			</li>

		</ul>
        {% endwith %}
	</div>

	<div class="footer">
		<div class="credit">עובד והונגש ע"י <a href="http://oknesset.org">כנסת פתוחה</a> ו<a href="http://yeda.us">הסדנא לידע ציבורי</a></div>
		<div class="share">
			<a href="#" class="embed">הטמעה</a>
			<a href="#" class="link">קישור</a>
		</div>
	</div>
</div>

