{% extends 'site_base.html' %}
{% load i18n %}
{% load links %}
{% load ratings %}
{% block extratitle %}{{ topic.title }}{% endblock %}
{% block extrahead %}
    <script type="text/javascript" src="{{MEDIA_URL}}js/watch.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
                register_watch({{object.id}}, "topic", "{% trans 'Watch' %}", "{% trans 'Unwatch' %}", {{watched_object|lower}}, "{% url user-follow-unfollow %}");
        });
    </script>

{% endblock %}
{% block subnav %}
    <ul class="actions">
        {% if user == topic.creator %}
            <li><a href="#">{% trans "Edit" %}</a></li>
        {% endif %}
        <li><span id="watch" class="awesome-button medium"></span></li>
    </ul>
{% endblock %}

{% block content %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.raty.min.js"></script>
    <h1>{% trans "Suggested Topic for a committee meeting" %}</h1>
    <h2>{{topic.title}}</h2>
    <h4>{% trans "by" %}: <a href="{% url public-profile topic.creator.id %}">{{topic.creator}}</a></h4>
    {% for c in object.committees.all %}
        <a href="{% url committee-detail c.id %}"><span style="font-size: 70%">{{c}}</span></a>
    {% endfor%}
    <p>{{topic.description}}</p>
    <br/>
    <h3> {% trans "average rating" %}: </h3>
    <div style="display:inline;" id="average_rating"></div>
    <div class="clear"></div>
    <h3> {% trans "your rating" %}: </h3>
    <div style="display:inline;" id="your_rating">{% if not user.is_authenticated %}{% trans 'Login to rank this topic' %}{% endif %}</div>
    <div class="clear"></div>
    <div>
        <h3>{% trans "Links" %}:</h3>
        {% object_links topic %}
    </div>
   <div class="clear"></div>

    {% include 'comments/object_comment_list.html' %}
    <script>
        $(document).ready(function() {
            $('#average_rating').raty({
                number: 7,
                start: {{topic.rating.get_rating}},
                readOnly: true,
                path: '{{ MEDIA_URL }}/img',
            });
            {% if user.is_authenticated %}
            {% rating_by_user user on topic.rating as vote %}
            $('#your_rating').raty({
                cancel: true,
                number: 7,
                start: {% if vote %}{{vote}}{% else %}0{%endif%},
                path: '{{ MEDIA_URL }}/img',
                click: function(score, evt) {
                    $.post('/committee/topic/{{object.id}}/'+score+'/')
                }
            });
            {% endif %}
        })
    </script>
{% endblock %}
