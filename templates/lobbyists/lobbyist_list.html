{% extends "site_base.html" %}
{% load i18n i18ninclude mks_tags lobbyists_tags %}{% load static from staticfiles %}
{% block extratitle %}{% trans "Lobbyists" %}{% endblock %}
{% block keywords %}{{% trans "Lobbyists" %}{% endblock %}
{% block description %}{% trans "Lobbyists" %} - {% trans 'Open Knesset - Opening the Knesset to the public' %}{% endblock %}

{% block breadcrumbs %}
    {% if is_historical %}
        <li><a href="{% url 'lobbyists' %}">{% trans "Lobbyists" %}</a> <span class="divider">/</span></li>
        <li class="active">{% trans "Historical Data" %} <span class="divider">/</span></li>
        <li class="active">{{ lobbyist_history.scrape_time | date:"d/m/y H:i"}}</li>
    {% else %}
        <li class="active">{% trans "Lobbyists" %}</li>
    {% endif %}
{% endblock %}

{% block divcontent %}
    <div class="row">
        <div class="cards span12">
            <section class="card card-list">
                <header>
                    <h2><i class="fa fa-users"></i>{% trans "Lobbyists" %}</h2>
                </header>
                <ul>
                    {% for lobbyist in object_list %}
                    <li>
                        <p class="item-title"><a href="{% url 'lobbyist-detail' lobbyist.id %}">{{lobbyist.display_name}}</a></p>
                        <p class="item-context">
                            {% if lobbyist.latest_data.profession %}{{ lobbyist.latest_data.profession }}, {% endif %}
                            {% if lobbyist.latest_corporation.name %}<a href="{% url 'lobbyist-corporation' lobbyist.latest_corporation.id %}">{{ lobbyist.latest_corporation.name }}</a>, {% endif %}
                            {% if lobbyist.latest_data.faction_member and lobbyist.latest_data.faction_member != "לא" %}
                                {% trans "Faction member" %}: {% if lobbyist.latest_data.faction_name %}
                                    {{ lobbyist.latest_data.faction_name }}
                                {% else %}
                                    {% trans "Unknown" %}
                                {% endif %},
                            {% endif %}
                            {% trans "Permit type" %}: {% if lobbyist.latest_data.permit_type %}{{ lobbyist.latest_data.permit_type }}{% else %}{% trans "Unknown" %}{% endif %}
                            <br/>
                            {% trans "Last change" %}: {{ lobbyist.latest_data.scrape_time|date:"DATE_FORMAT" }}
                        </p>
                    </li>
                    {% endfor %}
                </ul>
            </section>
            {% comment %}{% if corporations %}
                <section class="card card-list">
                    <header>
                        <h2><i class="fa fa-users"></i>{% trans "Corporations" %}</h2>
                    </header>
                    <ul>
                        {% for corporation in corporations %}
                        {% if corporation.name or corporation.source_id %}
                            <li>
                                <p class="item-title">
                                    <a href="{% url 'lobbyist-corporation' corporation.id %}">{% if corporation.name %}{{ corporation.name }}{% else %}{{ corporation.source_id }}{% endif %}</a>
                                </p>
                                <p class="item-context">
                                    {{ corporation.latest_data.lobbyists.count }} {% trans "Lobbyists" %},
                                    {% trans "Last change" %}: {{ corporation.latest_data.scrape_time|date:"DATE_FORMAT" }}
                                </p>
                            </li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </section>
            {% endif %}
            {% if not is_historical %}
                {% if history %}
                <section class="card card-list">
                    <header>
                        <h2><i class="fa fa-users"></i>{% trans "Changes" %}</h2>
                    </header>
                    <ul>
                        {% for lobbyist_history, next_lobbyist_history in history %}
                        <li>
                            <p class="item-title"><a href="{% url 'lobbyists' lobbyist_history.id %}">{{ lobbyist_history.scrape_time|date:"DATE_FORMAT" }}</a></p>
                            {% if next_lobbyist_history %}
                                {% if forloop.first %}
                                    <p class="item-context">{% trans "Current Lobbyists" %}</p>
                                {% endif  %}
                                <p class="item-context">{% lobbyists_diff next_lobbyist_history lobbyist_history %}</p>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </section>
                {% endif %}
            {% endif %}{% endcomment %}
        </div>
    </div>
{% endblock %}

